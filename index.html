<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Jingju Melodic Lines</title>
		<script type="text/javascript" src="d3.js"></script>
		<style type="text/css">

		  body {
				width: 800px;
				margin:0 auto;
			}

			h1 {
				text-align: center;
			}

			svg {
				border-style: solid;
				border-width: 1px;
				border-color: black;
			}

			.line {
				fill: none;
				stroke: orange;
				stroke-width: 8;
				/* opacity: 0.2; */
			}

		</style>
	</head>
	<body>
		<h1>Comparison of jingju singing lines</h1>

		<script type="text/javascript">

			var w = 800;
			var h = 250;
			var padding = 40;

			d3.json("code/melodies.json", function(data) {

				var dataset = data['melodies'];

				var maxTime = d3.max(dataset, function(d) {
					return d3.max(d.melody, function(d) {
						return d.time;
					});
				});

				var minPitch = d3.min(dataset, function(d) {
					return d3.min(d.melody, function(d) {
						if (d.pitch > 0) {
							return d.pitch;
						};
					});
				});

				var maxPitch = d3.max(dataset, function(d) {
					return d3.max(d.melody, function(d) {
						return d.pitch;
					});
				});

				var xScale = d3.scaleLinear()
				               .domain([0, maxTime])
				               .range([padding, w-padding]);

				var yScale = d3.scaleLinear()
				               .domain([minPitch, maxPitch])
											 .range([h-padding, padding]);

				var line = d3.line()
				             .defined(function(d) { return d.pitch > 0; })
				             .x(function(d) { return xScale(d.time); })
										 .y(function(d) { return yScale(d.pitch); })
										 .curve(d3.curveBasis);

				var opacity = 1 / dataset.length;

				var svg = d3.select("body")
							      .append("svg")
							      .attr("width", w)
							      .attr("height", h);

        dataset.forEach(function(d) {
					svg.append("path")
					   .datum(d.melody)
						 .attr("class", "line")
						 .attr("d", line)
						 .attr("opacity", opacity);
				});

			});

		</script>
	</body>
</html>
